---
import Card from '@/components/common/Card.astro';
import Code from '@/components/common/Code.astro';

export const contentOrder = 1;
export const id = 'dispatchEvent';
const code = `const event = new Event('myEvent', { cancelable: true });
const result = target.dispatchEvent(event);
console.log(result); // false なら preventDefault() が呼ばれた`;
---

<Card id={id}>
  <h2>target.dispatchEvent()について</h2>
  <p>任意のイベントを発火させることができる。</p>
  <p>
    戻り値の挙動が少し特殊で、イベントハンドラーがpreventDefaultを呼び出していたらfalse,
    そうでなければtrueを返すよ
  </p>
  <Code code={code} />
  <button type='button'>発火</button>
  <output></output>
</Card>

<script>
  const root = document.getElementById('dispatchEvent');
  if (root) {
    const button = root.querySelector('button');
    const output = root.querySelector('output');
    if (button && output) {
      // rootをターゲットに半分の確率でキャンセル
      const target = root;
      target.addEventListener('sampleEvent', (e) => {
        const cancel = Math.random() > 0.5;
        if (cancel) {
          e.preventDefault();
        }
      });

      button.addEventListener('click', () => {
        const event = new Event('sampleEvent', { cancelable: true });
        const result = target.dispatchEvent(event);
        output.textContent = `dispatchEventの戻り値： ${result}`;
      });
    }
  }
</script>
